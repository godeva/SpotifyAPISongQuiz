<html lang="en">
  <head>
    <title>CS4241 Final Project</title>
    <meta charset="utf-8">
     <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
    <link rel="stylesheet" type="text/css" href="css/style.css"/>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.5.2/animate.min.css">
    <script src="js/scripts.js"></script>
  </head>
  <body>
    <div class = "container">
      <div id="left"></div>
      <div id="right"></div>
      <div id="top"></div>
      <div id="bottom"></div>

      <div class ="center">
        <h1 class ="header">Select a playlist</h1>
        <table class ="votes">
        <tr>
            <td>
                <img class = "playlist" src="images/turnt.jpg">

            </td>
             <td>
                <img class = "playlist" src="images/top.jpg">

            </td>
             <td>
                <img class = "playlist" src="images/hot.jpg">

            </td>
             <td>
                <img class = "playlist" src="images/solid.jpg">

            </td>
             <td>
                <img class = "playlist" src="images/fresh.jpg">

            </td>
        </tr>

        </table>
        <br>
        
       <!-- <div id="countdown">-->

       <!-- </div>-->

        <hr></hr>


    <table class="table">
    <thead>
      <tr style="width: 60%">
        <th style="width:50px" >Position</th>
        <th style="width: 250px">Username</th>

      </tr>
    </thead>
    <tbody id="activelist">
    </tbody>
  </table>

  <table>
  
<tr>
  <td style="margin-left: 800px">
  <div id="chatroom" style="overflow-y: scroll;float: left; height: 200px; width: 500px;text-align: left; background-color:white; padding: 20px; border: 2px solid grey;">
    
  
  </div>
  <br>
  <br>
  <br>
  <input id="chatinput"></input>
  <button onclick="sentChat()">chat</button>
  </td>
<td>

  

  <a href="/login"><button onclick="" type="button" class="btn btn-info" style= "width: 200px; height: 50px; color: white; font-size:26; background-color: green; border-color: white;">Start Match</button>
  </a>
  <a href="/leaderboard.html">CLICK HERE FOR LEADERBOARD!</a>
</td>
</tr>
</table>
 </div>

</div>

<script src="/socket.io/socket.io.js"></script>
<script>

var socket = io.connect(location.origin);
var table = document.getElementById('activelist')
var chatroom = document.getElementById('chatroom')
var chatinput = document.getElementById('chatinput')
var yourname = ''

socket.on('updateList', function (data) {
  console.log('updatelist')
  buildTable(data)
})

socket.on('newChat', function (data) {
  console.log('newChat')
  var back = chatroom.innerHTML
  chatroom.innerHTML = '<p>'+data+'</p>'
  chatroom.innerHTML += back
})

newXHRRequest('POST', '/logIn', function(req){req.send('login')}, function(req){
  if (req.responseText !== 'bad'){
    yourname = req.responseText
    socket.emit('getList')
    console.log('your name is: '+yourname)
  }
})

function sentChat() {
  if (chatinput.value){
    socket.emit('sendChat', yourname+': '+chatinput.value)
    chatinput.value = ''
  }
}

function buildTable (list) {
    var newtable = ''
    //console.log(activeList)
    list.forEach(function(item, index, array) {
      newtable += '<tr class = "success">'
      newtable += '<td>'+index+'</td>'
      newtable += '<td>'+item.name+'</td>'
      newtable += '</tr>'
    })
    table.innerHTML = newtable
}

countdown( "countdown", 1, 5 );

// definitions
  function countdown( elementName, minutes, seconds ){
    var element, endTime, hours, mins, msLeft, time;

    function twoDigits( n )
    {
      return (n <= 9 ? "0" + n : n);
    }

    function updateTimer()
    {
      msLeft = endTime - (+new Date);
      if ( msLeft < 1000 ) {
        element.innerHTML = "countdown's over!";
      } else {
        time = new Date( msLeft );
        hours = time.getUTCHours();
        mins = time.getUTCMinutes();
        element.innerHTML = (hours ? hours + ':' + twoDigits( mins ) : mins) + ':' + twoDigits( time.getUTCSeconds() );
        setTimeout( updateTimer, time.getUTCMilliseconds() + 500 );
      }
    }

    element = document.getElementById( elementName );
    endTime = (+new Date) + 1000 * (60*minutes + seconds) + 500;
    updateTimer();
  }

// HF
// log out before closing the browser
window.onbeforeunload = function(event) {
  newXHRRequest('POST', '/logOut', function(req){
    req.send('logout')
  }, function(req){
  })
};

</script>

  </body>
</html>