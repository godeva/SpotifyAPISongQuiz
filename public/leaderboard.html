<html>
<head>
</head>

<body>
  <div class="content">
    <div class ="leadHead">
      <a href = "/lobby.html"> Return to Lobby </a> <!-- add animation to this!!! -->
      <h1 style="text-align: center;" class = "leadHead"><u>Leaderboard</u></h1>
    </div>
    <div class="playlistMenu">
      <table style="width: 100%; text-align: center;">
        <tr>
          <td><a href="#">Hey</a></td>
          <td><a href="#">Hey</a></td>
          <td><a href="#">Hey</a></td>
          <td><a href="#">Hey</a></td>
          <td><a href="#">Hey</a></td>
        </tr>
      </table>    
  
    </div>
  </div>
    
    <table id="board" style="width:100%">
      <tr>
        <th>Rank</th>
        <th>Player</th>
        <th>Score</th>
      </tr>
    </table>
  </div>
</body>

<script>
var names = [];
var scores = [];


var httpRequest;

function updateSpecificPlaylist() {
  httpRequest = new XMLHttpRequest();

  if (!httpRequest) {
    alert('giving up :( cannot create');
    return false;
  }

  var searchQuery = "testplaylist";
  console.log(searchQuery)
  httpRequest.onreadystatechange = handlePost;
  httpRequest.open('POST', '/leaders');
  httpRequest.send('plist=' + searchQuery);
}

function handlePost(req) {
  console.log("handling post");
  console.log(req);
  console.log(req.target);
  var req_targ = req.target; //whyyyy
  if (req_targ.readyState !== XMLHttpRequest.DONE) {
    return;
  }

  if (req_targ.status === 200) {
    console.log("2 hunna");
    var leaders = JSON.parse(req_targ.responseText);
    console.log(leaders)
//    localStorage.setItem('flights', req.responseText);
    //clear the inner html
    document.querySelector("#board").innerHTML = "<tr><th>Player</th><th>Score</th></tr>";
    buildList( leaders );
  }
}
console.log("getDBScores");

getDBScores('/leaders');

function getDBScores(url) {
  console.log("getDBScores function");
  var req = new XMLHttpRequest();
  req.onreadystatechange = function() {
    handleRes(req);
  }

  req.open('GET', url);
  req.send();
}

function handleRes(req) {
  console.log(req)
  console.log("handling result");
  if( req.readyState !== XMLHttpRequest.DONE )
  return;

  if(req.status === 200) {
    console.log("status 200")
    console.log(req.responseText);
    var leaders = JSON.parse(req.responseText);
    console.log(leaders)
//    localStorage.setItem('flights', req.responseText);
    buildList( leaders );
  }
}

function buildList( A ) {

  var i, toAppendString = "";
  var lineNum = 1;
  
  for (i = 0; i < A.length; i++) {
    console.log(A[i]);
    var separatorindex = A[i].indexOf('::');
    if (separatorindex === -1) {
      console.log("could not find : break");
      return
    }

    var name = A[i].substring(0, separatorindex);
    var score = A[i].substring(separatorindex+2);
    toAppendString += "<tr>" + "<td>" + lineNum + "</td>" + "<td>" + name + "</td>" + "<td>" + score + "</td>" + "</tr>";
    lineNum++;

  } 
  console.log("finished")
  console.log(toAppendString)

  document.querySelector("#board").innerHTML += toAppendString;

}

</script>
</html>